---
path: '/build-apps/build-a-custom-app'
duration: '15-30 min'
title: 'Build a custom app'
template: 'GuideTemplate'
description: 'Build a New Relic app showing pageview data on a world map.'
---

<intro>
## Build a New Relic app in 15 minutes or less

New Relic has powerful and flexible tools for building custom apps and populating them with data. This guide will show you how to build a custom app and populate it with data in 15 minutes or less using New Relic's Query Language (NRQL). (It's pronounced 'nurkle'.) If you have a little more time and want to install a 3rd party React library, I'll show you how to put that data on a map of the world.

Please review the **Before you begin** section to make sure you have everything you need and don't get stuck halfway through.

<!-- To add an embedded video, use the following video component (no need to import) and supply a YouTube video id:
<Video youtubeId="<add video id>" /> or <Video id=“<add video id>” type=“wistia”/> (((I assume this is the video that I would use? https://newrelic.com/resources/webinars/introtocustomappsnr1-191113?video=past-webinar))) -->
</intro>

<intro>
## Before you begin

In order to get the most out of this guide, you'll need to have:
- A New Relic developer account. (This includes an API key and the command-line tool. If you don't have this yet, go here to [get instructions on setting up your NR development environment](URL TBD).)
- New Relic Browser pageview data to populate the app. If you don't have pageview data, this probably isn't worth doing.

The following are necessary to complete the second half of the guide to draw your data on a world map.
- npm (If you're new to React and npm, you can go here to [install Node.js and npm](https://nodejs.org/en/download/).)
- Leaflet (A 3rd-party JavaScript React library used to build interactive maps. Installed with npm. You can read more about Leaflet [here](https://www.npmjs.com/package/leaflet).)

## New Relic Terminology

There's some New Relic terminology you may not be familiar with.

* Application: The finished product where data is rendered in New Relic One. This might look like a series of interactive charts or a map of the world.
* Nerdpack: The standard collection of JavaScript, JSON, CSS, and other files that control the functionality and look of your application.
* Launchers: The button on New Relic One that launches your application.
* Nerdlets: New Relic React components you'll use to build your application.
    - The three default files are `index.js`, `nr1.json`, and `styles.scss`, but you can customize and add your own.
    - Go here for more information on the [Nerdpack file structure](https://docs.newrelic.com/docs/new-relic-one/use-new-relic-one/build-new-relic-one/new-relic-one-application-nerdpack-file-structure).

<br />

<steps>

<step>
## Check that you've got the data for this exercise 

You'll use a tool called Chart Builder to write a NRQL query to see your page view data.

On New Relic One, click **Query your data** (it's in the top right corner), and then click **Advanced (NRQL)**. You'll use this to test your query before dropping the data into your table.

Copy and paste this into the query field, and then click **Run**.
```sql
FROM PageView SELECT count(*), average(duration) WHERE appName = 'WebPortal' FACET countryCode, regionCode SINCE 1 week ago LIMIT 1000
```

If you have pageview data, this query will show a week of average page views broken down by country and limited to a thousand items. The table will be full width and use the "chart" class defined in the CSS.

If you don't have any results at this point, you're app won't be very exciting.
</step>

<step>

## Start building a custom app

Before you can start building a custom application, you'll need to get your NR API key, create a new Nerdpack, and serve it up to NR from your local development environment.

Go to [one.newrelic.com](https://one.newrelic.com) and click **Build your own application**.

Once you complete the **Quick start** steps, you'll be ready to build your app.
</step>

<step>

## Build a New Relic app

Go to `https://one.newrelic.com/?nerdpacks=local` to see the local Nerdpack that you've served up. If you're not seeing your application, review the **Quick start** steps.
</step>

<step>

### Hard code your account ID

For the purposes of this exercise and your convenience, you'll hard code your account ID. (Read about finding your account ID here: https://docs.newrelic.com/docs/accounts/install-new-relic/account-setup/account-id )
```jsx
const accountId = [Replace with your account ID];
```
</step>

<step>

### Import the table chart component

To start with, your app will show your data in a table chart. In order to do that, you'll need to import a `TableChart` from New Relic One.

In the Nerdpack `index.js` file under `import React`, import a table chart from NR1.
```jsx
import { TableChart } from `nr1`;
```
</step>

<step>

### Add a table with a single row

To start with, you'll populate a table with your pageview data.

To add a table with a single row, find this:

```jsx
return <h1>Hello, myawesomenerdlet Nerdlet!</h1>;
```

and replace it with:
```jsx
export default class MyFirstNerdpackNerdletNerdlet extends React.Component {
    render() {
        return <div className="container">
            <div className="row">

            </div>
        
        </div>
    }
}
```
</step>

<step>

### Customize the look of your table (optional)

You can use standard CSS to customize the look of your components. 

In the `styles.scss` file, add this CSS:

```css
.container {
  width: 100%;
  height: 99vh;
  display: flex;
  flex-direction: column;
  .row {
    margin: 10px;
    display: flex;
    flex-direction: row;
  }
  .chart {
    height: 250px;
  }
}
```

Feel free to customize this CSS to your taste.
</step>

<step>

### Get your data into that table

Now that you've got a table, you can drop a TableChart populated with data from the NRQL query you wrote at the very beginning of this guide.

Put this code into the `row` div.

```jsx
<TableChart accountId={accountId} query={`FROM PageView SELECT count(+), average(duration) WHERE appName = 'WebPortal' SINCE 1 week ago LIMIT 1000`} fullWidth className="chart" />
```

Go to New Relic One and click your app to see your data in the table. (You may need to serve your app to New Relic again.)

You've completed your first app! Continue on to make it interactive.
</step>

<step>
## Make your app interactive with a text field

Once you've confirmed that data is getting to New Relic from your app, you can start customizing it and making it interactive. Next, you'll add a text field to filter your data. After that, you'll use a 3rd-party library called Leaflet to show that data on a world map.
</step>

<step>
### Import the TextField component

Like the TableChart, you'll need to import a TextField component from New Relic One.

```jsx
import { TextField } from 'nr1';
```
</step>

<step>

### Add a row for your text field

You'll probably want your text field filter above the table. Put this above the TableChart div.
```jsx
<div className="row">
    <TextField placeholder="US" onChange={(event) => {
        this.setState({ countryCode: event.target.value });
    }} />
</div>
```

The text field will have a default value of "US".
</step>

<step>

### Build the text field object

Above the render() function, add a constructor to build the text field object.

```jsx
constructor(props) {
    super(props);
    this.state = {
        countryCode: null
    }
}
```

You'll also need to add a constructor to your render() function. Above `return`, add:

```jsx
const { countryCode } = this.state;
```

Now add country code to your table chart query.

```jsx
<TableChart accountId={accountId} query={`FROM PageView SELECT count(+), average(duration) WHERE appName = 'WebPortal' **${countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''} FACET countryCode, regionCode** SINCE 1 week ago LIMIT 1000`} fullWidth className="chart" />
```

Reload your app to try out the text field.
</step>

## Get your data on a map

Before you continue with this section, you'll need to use npm to install Leaflet.

<step>

### Install Leaflet (optional if you've already got it installed)

Use npm to install Leaflet. In your terminal, type:
```
npm install --save leaflet react-leaflet 
```

In the Nerdpack `styles.scss`, import the Leaflet CSS:
```css
@import `~leaflet/dist/leaflet.css`
```

Add some CSS for your map.
```css
.containerMap {
  width: 100%;
  z-index: 0;
  height: 70vh;
}
```
</step>

<step>

### Add a webpack config file for Leaflet

Add a webpack configuration file `.extended-webpackrc.js` to the top-level folder in your nerdpack. This will support your use of map tiling information data from Leaflet.
```jsx
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpe?g|gif)$/,
        use: [
          {
            loader: 'file-loader',
            options: {},
          },
          {
            loader: 'url-loader',
            options: { limit: 25000 },
          }
        ]
      }
    ]
  }
};
```
</step>

<step>

### Import modules from Leaflet

In `index.js`, import modules from Leaflet.
```jsx
import { Map, CircleMarker, TileLayer } from 'react-leaflet';
```
</step>

<step>

### Import additional modules from New Relic One

You'll need some more modules from New Relic One to make the Leaflet map work well.

```jsx
import { NerdGraphQuery, Spinner, Button, BlockText } from 'nr1';
```

NerdGraphQuery lets you multiple NRQL queries at once and is what will populate the map with data. Spinner will add a loading spinner. Button will give you button components. BlockText will give you block text components.
</step>

<step>

### Get data for the map

Using latitude and longitude with country codes, you can put New Relic data on a map.

```jsx
mapData() {
    const { countryCode } = this.state;
    const query = `{
      actor {
        account(id: 1606862) {
          mapData: nrql(query: "SELECT count(*) as x, average(duration) as y, sum(asnLatitude)/count(*) as lat, sum(asnLongitude)/count(*) as lng FROM PageView FACET regionCode, countryCode WHERE appName = 'WebPortal' ${countryCode ? ` WHERE countryCode like '%${countryCode}%' ` : ''} LIMIT 1000 ") {
            results
            nrql
          }
        }
      }
    }`;
    // console.debug(query);
    return query;
};
```
</step>

<step>

### Customize the map marker colors

Above the mapData function, add this code to customize the map marker colors.

```jsx
    getMarkerColor(measure, apdexTarget = 1.7) {
        if (measure <= apdexTarget) {
          return '#11A600';
        } else if (measure >= apdexTarget && measure <= apdexTarget * 4) {
          return '#FFD966';
        } else {
          return '#BF0016';
        }
    };
```

Change the HTML color code values to your taste.

`#11A600` is green, `#FFD966` is sort of yellow, and `#BF0016` is red.
</step>

<step>

### Set your map's default center point

Set a default center point for your map using latitude and longitude.
```jsx
const defaultMapCenter = [10.5731, -7.5898];
```
</step>

<step>

### Add a row for your map

Between the text field row and the table chart row, insert a new row for the map content using NerdGraphQuery. Reload your application in New Relic One to test that it works. 
```jsx
<div className="row">
    <NerdGraphQuery query={this.mapData()}>
        {({ loading, error, data}) ==> {
            if (loading) {
                return <Spinner fillContainer />
                }
            if (error) {
                return "Error";
            }
            const { results } = 
            data.actor.account.mapData;
            console.debug(results);
            return "Hello";
        }
    }

    </NerdGraphQuery>
</div>
```
</step>

<step>

### Replace "Hello" with the Leaflet code

Replace `return "Hello";` with:

```jsx
    return <Map
    className="containerMap"
    center={defaultMapCenter}
    zoom={2}
    zoomControl>
    <TileLayer
      attribution='&amp;copy <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
      url="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"
    />
    {results.map((pt, i) => {
      const center = [pt.lat, pt.lng];
      return (
        <CircleMarker
          key={`circle-${i}`}
          center={center}
          color={this.getMarkerColor(pt.y)}
          radius={Math.log(pt.x) * 3}
          onClick={() => {
            alert(JSON.stringify(pt));
          }}
        />
      );
    })}
</Map>
```
</step>

This code creates a world map centered on the latitude and longitude you chose using OpenStreetMap data and your marker colors.

Reload your app to see the pageview data on the map!


## Related info

- Link to next logical guide
- Links to related content like reference docs
- Links to related opensource.newrelic.com, docs.newrelic.com, blog, git docs, or other related content.  

